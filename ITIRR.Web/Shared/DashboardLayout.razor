@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject CustomAuthStateProvider AuthStateProvider
@using ITIRR.Web.Auth

<!-- HEADER -->
<header id="header" class="header fixed-top d-flex align-items-center">
    <div class="d-flex align-items-center justify-content-between">
        <a href="/partner-home" class="logo d-flex align-items-center">
            <img src="img/logo.png" alt="logo" />
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
    </div>

    <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
            <li class="nav-item dropdown pe-3">
                <a class="nav-link nav-profile d-flex align-items-center pe-0"
                   href="#" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="img/user-profile.jpg" alt="avatar"
                         class="rounded-circle" width="36" height="36" />
                    <span class="d-none d-md-block ps-2">@userName</span>
                    <i class="bi bi-chevron-down ms-1"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                    <li class="dropdown-header d-flex align-items-center">
                        <img src="img/user-profile.jpg" alt="Profile"
                             class="rounded-circle me-2" width="45" height="45" />
                        <div>
                            <h6 class="mb-0">@userName</h6>
                            <small class="text-muted">Partner</small>
                        </div>
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#">
                            <i class="bi bi-person me-2"></i>
                            <span>My Profile</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#">
                            <i class="bi bi-gear me-2"></i>
                            <span>Account Settings</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#">
                            <i class="bi bi-question-circle me-2"></i>
                            <span>Help</span>
                        </a>
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#"
                           @onclick="HandleLogout" @onclick:preventDefault="true">
                            <i class="bi bi-box-arrow-right me-2"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>
</header>

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
    <ul class="sidebar-nav" id="sidebar-nav">

        <li class="nav-item">
            <a href="/dashboard" class="nav-link @IsActive("/dashboard")">
                <i class="bi bi-columns-gap"></i>
                <span>Overview</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/earnings" class="nav-link @IsActive("/earnings")">
                <i class="bi bi-wallet"></i>
                <span>Earnings & Payouts</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/personal-information" class="nav-link @IsActive("/personal-information")">
                <i class="fa-regular fa-user"></i>
                <span>Personal Information</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/my-listings" class="nav-link @IsActive("/my-listings")">
                <i class="fa-solid fa-car-rear"></i>
                <span>All Listed Vehicles</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/trips" class="nav-link @IsActive("/trips")">
                <i class="bi bi-geo-alt"></i>
                <span>Trips & Tour</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/calendar" class="nav-link @IsActive("/calendar")">
                <i class="bi bi-calendar2-week"></i>
                <span>Booking Calendar</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/messages" class="nav-link @IsActive("/messages")">
                <i class="bi bi-chat-text"></i>
                <span>Messages</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/reviews" class="nav-link @IsActive("/reviews")">
                <i class="bi bi-star"></i>
                <span>Reviews & Rating</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="/notifications" class="nav-link @IsActive("/notifications")">
                <i class="bi bi-bell"></i>
                <span>Notification</span>
            </a>
        </li>

        <hr />

        <button class="sett">
            <i class="bi bi-gear"></i>
            <span><a href="/account-settings">Account Security</a></span>
        </button>

        <button class="logg" type="button"
                data-bs-toggle="modal" data-bs-target="#logoutModal">
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
            <span>Logout</span>
        </button>

    </ul>
</aside>

<!-- MAIN CONTENT -->
<main id="main">
    @Body

    <!-- ✅ FOOTER INSIDE MAIN so it respects sidebar offset -->
    <footer class="footer-sec bg-light pt-5 pb-3 border-top">
        <div class="container">
            <div class="row gy-4">
                <div class="col-12 col-md-4 foot">
                    <img src="img/logo.png" alt="ITIRR Logo" class="mb-3" style="height: 40px;" />
                    <p>ITIRR is a global luxury rental platform offering premium access to exotic cars, private jets, and high-end yachts. We connect discerning travelers with verified partners across the world — delivering convenience, safety, and elevated service at every touchpoint.</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-dark"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-dark"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-dark"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-dark"><i class="fa-brands fa-youtube"></i></a>
                    </div>
                </div>
                <div class="col-6 col-md-2 links">
                    <h6>Company</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#" class="text-muted text-decoration-none">Home</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Contact</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Destinations</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Categories</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Get a Quote</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md-2 links">
                    <h6>Help</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#" class="text-muted text-decoration-none">Terms &amp; Conditions</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Privacy Policy</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Refund Policy</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Customer Support</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Partnership</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-4 links">
                    <h6>Newsletter</h6>
                    <div class="mb-3">
                        <label class="mb-2">Email Address</label>
                        <input type="email" class="form-control" placeholder="Email Address" />
                    </div>
                    <button class="btn sub-btn w-100">Subscribe for Newsletter</button>
                    <div class="d-flex justify-content-center gap-3 mt-3">
                        <img src="img/stripe.png" alt="Stripe" style="height: 20px;" />
                        <img src="img/bank.png" alt="Visa" style="height: 20px;" />
                        <img src="img/cloud.png" alt="Mastercard" style="height: 20px;" />
                        <img src="img/bit.png" alt="Discover" style="height: 20px;" />
                    </div>
                </div>
            </div>
            <div class="text-center mt-4 copyright">
                © Copyright 2024. All Rights Reserved by ITIRR
            </div>
        </div>
    </footer>
</main>

<!-- LOGOUT MODAL -->
<div class="modal fade logout-modal" id="logoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Are you sure you want to log out?</h5>
            </div>
            <div class="modal-body">
                <p>You will be logged out of your account and redirected to the login page.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-logout" @onclick="HandleLogout">Logout</button>
            </div>
        </div>
    </div>
</div>

@code {
    private string userName = "Partner";

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        if (user.Identity?.IsAuthenticated == true)
        {
            userName = user.FindFirst("FirstName")?.Value
                    ?? user.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value
                    ?? "Partner";
        }
    }

    private string IsActive(string href)
    {
        var currentUrl = Navigation.Uri;
        var baseUri = Navigation.BaseUri.TrimEnd('/');
        var fullHref = baseUri + href;
        return currentUrl.Equals(fullHref, StringComparison.OrdinalIgnoreCase) ? "active" : "";
    }

    private async Task HandleLogout()
    {
        await AuthStateProvider.MarkUserAsLoggedOut();
        Navigation.NavigateTo("/");
    }
}