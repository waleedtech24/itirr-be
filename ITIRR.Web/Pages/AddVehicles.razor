@page "/addvehicles"
@layout ITIRR.Web.Shared.NoFooterLayout
@attribute [Authorize]
@inject NavigationManager Navigation
@inject CustomAuthStateProvider AuthStateProvider
@inject IAuthApiService AuthService
@using Microsoft.AspNetCore.Authorization
@using ITIRR.Web.Auth
@using ITIRR.Web.Services

<!-- NAVBAR -->
<nav class="navbar navbar-light">
    <div class="container">
        <a class="navbar-brand">
            <img src="img/logo.png" />
        </a>
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center mb-0 p-0">
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0"
                       href="#" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="img/user-profile.jpg" alt="avatar"
                             class="rounded-circle" width="36" height="36" />
                        <span class="d-none d-md-block ps-2">@userName</span>
                        <i class="bi bi-chevron-down ms-1"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li class="dropdown-header d-flex align-items-center">
                            <img src="img/user-profile.jpg" alt="Profile"
                                 class="rounded-circle me-2" width="45" height="45" />
                            <div>
                                <h6 class="mb-0">@userName</h6>
                                <small class="text-muted">Partner</small>
                            </div>
                        </li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <i class="bi bi-person me-2"></i>
                                <span>My Profile</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <i class="bi bi-gear me-2"></i>
                                <span>Account Settings</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <i class="bi bi-question-circle me-2"></i>
                                <span>Help</span>
                            </a>
                        </li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center"
                               href="#" @onclick="HandleLogout" @onclick:preventDefault="true">
                                <i class="bi bi-box-arrow-right me-2"></i>
                                <span>Logout</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</nav>

<!-- WHAT YOU WANT TO LIST SECTION -->
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6 col-12 passcode-sec">
            <div class="text-center mt-5 mb-2">
                <h3 class="header-partener">What you want to list?</h3>
                <p class="header-partener-para">Join a fast-growing network of verified hosts earning from their premium assets.</p>
            </div>
        </div>
    </div>

    <div class="row g-3 UPPER">

        <!-- CARD 1 - Luxury Car -->
        <div class="col-lg-4">
            <div class="radio-card @(selectedVehicle == "car" ? "radio-active" : "")"
                 @onclick="SelectCar">
                <div class="radio-circle @(selectedVehicle == "car" ? "radio-circle-active" : "")">
                    @if (selectedVehicle == "car")
                    {
                        <div class="radio-dot"></div>
                    }
                </div>
                <img src="img/car-logo.png" alt="Luxury Car" class="card-vehicle-img" />
                <div class="modal-heading">Luxury Car</div>
                <div class="modal-text">Join a fast-growing network of verified hosts earning from their premium assets.</div>
            </div>
        </div>

        <!-- CARD 2 - Private Jet -->
        <div class="col-lg-4">
            <div class="radio-card @(selectedVehicle == "jet" ? "radio-active" : "")"
                 @onclick="SelectJet">
                <div class="radio-circle @(selectedVehicle == "jet" ? "radio-circle-active" : "")">
                    @if (selectedVehicle == "jet")
                    {
                        <div class="radio-dot"></div>
                    }
                </div>
                <img src="img/jet.png" alt="Private Jet" class="card-vehicle-img" />
                <div class="modal-heading">Private Jet</div>
                <div class="modal-text">Join a fast-growing network of verified hosts earning from their premium assets.</div>
            </div>
        </div>

        <!-- CARD 3 - Yacht/Boat -->
        <div class="col-lg-4">
            <div class="radio-card @(selectedVehicle == "boat" ? "radio-active" : "")"
                 @onclick="SelectBoat">
                <div class="radio-circle @(selectedVehicle == "boat" ? "radio-circle-active" : "")">
                    @if (selectedVehicle == "boat")
                    {
                        <div class="radio-dot"></div>
                    }
                </div>
                <img src="img/boat.png" alt="Yacht/Boat" class="card-vehicle-img" />
                <div class="modal-heading">Yacht/Boat</div>
                <div class="modal-text">Join a fast-growing network of verified hosts earning from their premium assets.</div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="select-vehbtn">
                <button type="button" class="btn-bac mb-3" @onclick="GoBack">Back</button>
                <button type="button" class="btn-nex mb-3"
                        @onclick="ShowModal"
                        disabled="@(string.IsNullOrEmpty(selectedVehicle))">
                    Next
                </button>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="footer-sec bg-light pt-5 pb-3 border-top">
    <div class="container">
        <div class="row gy-4">
            <div class="col-12 col-md-4 foot">
                <img src="img/logo.png" alt="ITIRR Logo" class="mb-3" style="height: 40px;" />
                <p>ITIRR is a global luxury rental platform offering premium access to exotic cars, private jets, and high-end yachts. We connect discerning travelers with verified partners across the world — delivering convenience, safety, and elevated service at every touchpoint.</p>
                <div class="d-flex gap-3">
                    <a href="#" class="text-dark"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-dark"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-dark"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-dark"><i class="fa-brands fa-youtube"></i></a>
                </div>
            </div>
            <div class="col-6 col-md-2 links">
                <h6>Company</h6>
                <ul class="list-unstyled small">
                    <li><a href="#" class="text-muted text-decoration-none">Home</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Contact</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Destinations</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Categories</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Get a Quote</a></li>
                </ul>
            </div>
            <div class="col-6 col-md-2 links">
                <h6>Help</h6>
                <ul class="list-unstyled small">
                    <li><a href="#" class="text-muted text-decoration-none">Terms &amp; Conditions</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Privacy Policy</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Refund Policy</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Customer Support</a></li>
                    <li><a href="#" class="text-muted text-decoration-none">Partnership</a></li>
                </ul>
            </div>
            <div class="col-12 col-md-4 links">
                <h6>Newsletter</h6>
                <div class="mb-3">
                    <label class="mb-2">Email Address</label>
                    <input type="email" class="form-control" placeholder="Email Address" />
                </div>
                <button class="btn sub-btn w-100">Subscribe for Newsletter</button>
                <div class="d-flex justify-content-center gap-3 mt-3">
                    <img src="img/stripe.png" alt="Stripe" style="height: 20px;" />
                    <img src="img/bank.png" alt="Visa" style="height: 20px;" />
                    <img src="img/cloud.png" alt="Mastercard" style="height: 20px;" />
                    <img src="img/bit.png" alt="Discover" style="height: 20px;" />
                </div>
            </div>
        </div>
        <div class="text-center mt-4 copyright">
            © Copyright 2024. All Rights Reserved by ITIRR
        </div>
    </div>
</footer>

<!-- MODAL — content changes based on selected vehicle -->
@if (showModal)
{
    <div class="modal fade show uneed-modal" style="display:block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <h1>What You Need?</h1>
                    <p class="uneed-main-hed">This will take 10 minutes, and you'll need:</p>

                    @if (selectedVehicle == "car")
                    {
                        <div class="info-item">
                            <div class="info-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none">
                                    <path d="M22.7502 11.6673C22.7502 7.26754 22.7502 5.06766 21.3835 3.70082C20.0166 2.33398 17.8167 2.33398 13.4169 2.33398H12.2503C7.85063 2.33398 5.65076 2.33398 4.28393 3.7008C2.91709 5.06762 2.91707 7.26749 2.91704 11.6672L2.91699 16.3339C2.91696 20.7337 2.91693 22.9336 4.28378 24.3005C5.65061 25.6673 7.85051 25.6673 12.2503 25.6673H14.0003" stroke="#552D6C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M8.16699 8.16602H17.5003M8.16699 13.9993H15.7503" stroke="#552D6C" stroke-width="1.5" stroke-linecap="round" />
                                    <path d="M18.5052 25.666H23.4955C24.5281 25.666 25.4013 24.9645 24.9715 24.2112C24.2827 23.0044 22.7636 22.166 21.0003 22.166C19.237 22.166 17.7179 23.0044 17.0291 24.2112C16.5993 24.9645 17.4726 25.666 18.5052 25.666Z" stroke="#552D6C" stroke-width="1.5" stroke-linejoin="round" />
                                    <path d="M20.9967 19.2493C22.1249 19.2493 23.0393 18.3353 23.0393 17.2077C23.0393 16.0801 22.1249 15.166 20.9967 15.166C19.8687 15.166 18.9541 16.0801 18.9541 17.2077C18.9541 18.3353 19.8687 19.2493 20.9967 19.2493Z" stroke="#552D6C" stroke-width="1.5" />
                                </svg>
                            </div>
                            <div>
                                <div class="info-title">Driving Licence</div>
                                <p class="info-text">We need this to ensure your car is protected by our vehicle protection packages.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none">
                                    <path d="M22.7502 11.6673C22.7502 7.26754 22.7502 5.06766 21.3835 3.70082C20.0166 2.33398 17.8167 2.33398 13.4169 2.33398H12.2503C7.85063 2.33398 5.65076 2.33398 4.28393 3.7008C2.91709 5.06762 2.91707 7.26749 2.91704 11.6672L2.91699 16.3339C2.91696 20.7337 2.91693 22.9336 4.28378 24.3005C5.65061 25.6673 7.85051 25.6673 12.2503 25.6673H14.0003" stroke="#552D6C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M8.16699 8.16602H17.5003M8.16699 13.9993H15.7503" stroke="#552D6C" stroke-width="1.5" stroke-linecap="round" />
                                    <path d="M18.5052 25.666H23.4955C24.5281 25.666 25.4013 24.9645 24.9715 24.2112C24.2827 23.0044 22.7636 22.166 21.0003 22.166C19.237 22.166 17.7179 23.0044 17.0291 24.2112C16.5993 24.9645 17.4726 25.666 18.5052 25.666Z" stroke="#552D6C" stroke-width="1.5" stroke-linejoin="round" />
                                    <path d="M20.9967 19.2493C22.1249 19.2493 23.0393 18.3353 23.0393 17.2077C23.0393 16.0801 22.1249 15.166 20.9967 15.166C19.8687 15.166 18.9541 16.0801 18.9541 17.2077C18.9541 18.3353 19.8687 19.2493 20.9967 19.2493Z" stroke="#552D6C" stroke-width="1.5" />
                                </svg>
                            </div>
                            <div>
                                <div class="info-title">Licence Plate Number</div>
                                <p class="info-text">We need this to ensure your car is protected by our vehicle protection packages.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none">
                                    <path d="M7 20.9703C7.15015 22.4967 7.48949 23.5242 8.25639 24.291C9.63195 25.6667 11.8459 25.6667 16.2737 25.6667C20.7016 25.6667 22.9155 25.6667 24.291 24.291C25.6667 22.9155 25.6667 20.7016 25.6667 16.2737C25.6667 11.8459 25.6667 9.63195 24.291 8.25639C23.5242 7.48949 22.4967 7.15015 20.9703 7" stroke="#552D6C" stroke-width="1.5" />
                                    <path d="M2.33301 11.6673C2.33301 7.26754 2.33301 5.06766 3.69984 3.70082C5.06668 2.33398 7.26656 2.33398 11.6663 2.33398C16.0661 2.33398 18.2661 2.33398 19.6328 3.70082C20.9997 5.06766 20.9997 7.26754 20.9997 11.6673C20.9997 16.0671 20.9997 18.267 19.6328 19.6338C18.2661 21.0006 16.0661 21.0007 11.6663 21.0007C7.26656 21.0007 5.06668 21.0006 3.69984 19.6338C2.33301 18.267 2.33301 16.0671 2.33301 11.6673Z" stroke="#552D6C" stroke-width="1.5" />
                                    <path d="M2.33301 12.9723C3.0552 12.8805 3.78532 12.8352 4.51667 12.8367C7.6106 12.7795 10.6288 13.623 13.0326 15.2168C15.262 16.695 16.8285 18.7292 17.4997 21.0007" stroke="#552D6C" stroke-width="1.5" stroke-linejoin="round" />
                                    <path d="M15.166 8.16602H15.1765" stroke="#552D6C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <div>
                                <div class="info-title">Photos of Your Car</div>
                                <p class="info-text">Guests need to see your car before they book it. Don't worry about this yet – we'll coach you on taking high quality photos later.</p>
                            </div>
                        </div>
                    }

                    @if (selectedVehicle == "boat")
                    {
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-file-earmark-text fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Skipper / Captain Licence</div>
                                <p class="info-text">We require a valid skipper or captain licence to ensure safety on the water.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-card-text fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Boat Registration Number</div>
                                <p class="info-text">We need this to verify ownership and ensure compliance with maritime regulations.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-camera fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Photos of Your Boat</div>
                                <p class="info-text">Guests want to see your boat before booking. Upload clear interior and exterior shots.</p>
                            </div>
                        </div>
                    }

                    @if (selectedVehicle == "jet")
                    {
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-file-earmark-medical fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Pilot Licence (ATPL/CPL)</div>
                                <p class="info-text">A certified pilot licence is required to list your private jet on ITIRR.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-shield-check fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Airworthiness & Insurance Documents</div>
                                <p class="info-text">We require proof of airworthiness certification and valid insurance to protect all parties.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="bi bi-camera fs-4" style="color:#552D6C"></i></div>
                            <div>
                                <div class="info-title">Photos of Your Jet</div>
                                <p class="info-text">Upload high-quality interior and exterior photos so guests know exactly what to expect.</p>
                            </div>
                        </div>
                    }

                </div>
                <div class="modal-footer">
                    <a href="#" @onclick="GoToListVehicle" @onclick:preventDefault="true">Continue</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show" @onclick="CloseModal"></div>
}

@code {
    private string userName = "Partner";
    private string selectedVehicle = "";
    private bool showModal = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        if (user.Identity?.IsAuthenticated == true)
        {
            userName = user.FindFirst("FirstName")?.Value
                    ?? user.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value
                    ?? user.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value
                    ?? "Partner";
        }
    }

    private void SelectCar() => selectedVehicle = "car";
    private void SelectJet() => selectedVehicle = "jet";
    private void SelectBoat() => selectedVehicle = "boat";

    private void ShowModal()
    {
        if (!string.IsNullOrEmpty(selectedVehicle))
            showModal = true;
    }

    private void CloseModal() => showModal = false;
    private void GoBack() => Navigation.NavigateTo("my-listings");

    // ✅ THIS is the updated function — routes to correct page per vehicle type
    private void GoToListVehicle()
    {
        showModal = false;
        var route = selectedVehicle switch
        {
            "car" => "/list-vehicle",
            "boat" => "/list-boat",
            "jet" => "/list-jet",
            _ => "/list-vehicle"
        };
        Navigation.NavigateTo(route);
    }

    private async Task HandleLogout()
    {
        await AuthStateProvider.MarkUserAsLoggedOut();
        Navigation.NavigateTo("/");
    }
}